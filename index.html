<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>電気料金比較ツール</title>
<style>
  body {
    font-family: Arial, sans-serif;
    padding: 1em;
  }
  input[type="number"] {
    font-size: 1.2em;
    padding: 0.3em;
    width: 100px;
  }
  button {
    font-size: 1.2em;
    padding: 0.4em 1em;
    margin-left: 0.5em;
    cursor: pointer;
  }
  .table-wrapper {
    overflow-x: auto;
    margin-top: 1em;
  }
  table {
    border-collapse: collapse;
    width: 100%;
    min-width: 900px;
  }
  th, td {
    border: 1px solid #888;
    padding: 8px 12px;
    text-align: center;
    font-size: 1.1em;
  }
  th {
    background-color: #eee;
    position: sticky;
    top: 0;
    z-index: 1;
  }
  .left-col {
    font-weight: bold;
    background-color: #f9f9f9;
    width: 80px;
  }
  /* 縦結合したセルの中央寄せ */
  .vertical-merge {
    vertical-align: middle;
  }
  @media (max-width: 600px) {
    th, td {
      font-size: 1.3em;
      padding: 10px 14px;
    }
    input[type="number"] {
      width: 140px;
      font-size: 1.4em;
    }
    button {
      font-size: 1.4em;
      padding: 0.5em 1.2em;
    }
  }
</style>
</head>
<body>

<h2>電気料金比較ツール</h2>
<label for="usage">使用電力量 (kWh)：</label>
<input type="number" id="usage" min="0" value="350" />
<button onclick="calculate()">計算する</button>

<div class="table-wrapper" id="result"></div>

<script>
  // 電力会社データ（基本料金は円/月、段階料金は円/kWh）
  const companies = [
    {
      name: "東京電力",
      basic: 1320,
      tiers: [
        { max: 120, rate: 19.88 },
        { max: 300, rate: 26.48 },
        { max: Infinity, rate: 30.57 }
      ],
      fuelAdjustment: 1.35,  // 仮の燃料調整費（円/kWh）
      reEnergyCharge: 3.45   // 再エネ賦課金（円/kWh）
    },
    {
      name: "ソフトバンクでんき",
      basic: 0,
      tiers: [
        { max: 120, rate: 17 },
        { max: 300, rate: 22 },
        { max: Infinity, rate: 24 }
      ],
      fuelAdjustment: 1.35,
      reEnergyCharge: 3.45
    },
    {
      name: "ドコモでんき",
      basic: 0,
      tiers: [
        { max: 120, rate: 18 },
        { max: 300, rate: 23 },
        { max: Infinity, rate: 25 }
      ],
      fuelAdjustment: 1.35,
      reEnergyCharge: 3.45
    },
    {
      name: "auでんき",
      basic: 0,
      tiers: [
        { max: 120, rate: 17.5 },
        { max: 300, rate: 22.5 },
        { max: Infinity, rate: 24.5 }
      ],
      fuelAdjustment: 1.35,
      reEnergyCharge: 3.45
    },
    {
      name: "楽天でんき",
      basic: 0,
      tiers: [
        { max: Infinity, rate: 26.5 }
      ],
      fuelAdjustment: 1.35,
      reEnergyCharge: 3.45
    },
    {
      name: "J:COM電力",
      basic: 880,
      tiers: [
        { max: 120, rate: 20 },
        { max: 300, rate: 25 },
        { max: Infinity, rate: 28 }
      ],
      fuelAdjustment: 1.35,
      reEnergyCharge: 3.45
    },
    {
      name: "東京ガスの電気",
      basic: 1100,
      tiers: [
        { max: 120, rate: 19 },
        { max: 300, rate: 24 },
        { max: Infinity, rate: 27 }
      ],
      fuelAdjustment: 1.35,
      reEnergyCharge: 3.45
    },
    {
      name: "コープデリでんき",
      basic: 770,
      tiers: [
        { max: 120, rate: 18 },
        { max: 300, rate: 23 },
        { max: Infinity, rate: 26 }
      ],
      fuelAdjustment: 1.35,
      reEnergyCharge: 3.45
    },
    {
      name: "イオンでんき",
      basic: 0,
      tiers: [
        { max: Infinity, rate: 27 }
      ],
      fuelAdjustment: 1.35,
      reEnergyCharge: 3.45
    },
    {
      name: "ヤマダのでんき",
      basic: 880,
      tiers: [
        { max: 120, rate: 19.5 },
        { max: 300, rate: 24.5 },
        { max: Infinity, rate: 27.5 }
      ],
      fuelAdjustment: 1.35,
      reEnergyCharge: 3.45
    },
    {
      name: "Looopでんき",
      basic: 0,
      tiers: [
        { max: Infinity, rate: 26.4 }
      ],
      fuelAdjustment: 1.35,
      reEnergyCharge: 3.45
    },
    {
      name: "TERASELでんき",
      basic: 0,
      tiers: [
        { max: 120, rate: 18 },
        { max: 300, rate: 22 },
        { max: Infinity, rate: 25 }
      ],
      fuelAdjustment: 1.35,
      reEnergyCharge: 3.45
    },
    {
      name: "ENEOSでんき",
      basic: 880,
      tiers: [
        { max: 120, rate: 20 },
        { max: 300, rate: 25 },
        { max: Infinity, rate: 28 }
      ],
      fuelAdjustment: 1.35,
      reEnergyCharge: 3.45
    },
    {
      name: "しろくま電力",
      basic: 0,
      tiers: [
        { max: Infinity, rate: 27 }
      ],
      fuelAdjustment: 1.35,
      reEnergyCharge: 3.45
    },
    {
      name: "CDエナジー",
      basic: 770,
      tiers: [
        { max: 120, rate: 19 },
        { max: 300, rate: 24 },
        { max: Infinity, rate: 26 }
      ],
      fuelAdjustment: 1.35,
      reEnergyCharge: 3.45
    },
    {
      name: "HTBエナジー",
      basic: 770,
      tiers: [
        { max: 120, rate: 18.5 },
        { max: 300, rate: 23.5 },
        { max: Infinity, rate: 26.5 }
      ],
      fuelAdjustment: 1.35,
      reEnergyCharge: 3.45
    },
    {
      name: "アースインフィニティ",
      basic: 880,
      tiers: [
        { max: 120, rate: 19 },
        { max: 300, rate: 23 },
        { max: Infinity, rate: 26 }
      ],
      fuelAdjustment: 1.35,
      reEnergyCharge: 3.45
    }
  ];

  function calculate() {
    const usage = Number(document.getElementById("usage").value);
    if (isNaN(usage) || usage < 0) {
      alert("0以上の使用電力量を入力してください。");
      return;
    }

    // 電力量ごとの料金計算（3段階に分けて計算）
    function calcTierCost(tiers, usage) {
      let remaining = usage;
      const costs = [];
      let lastMax = 0;
      for (const tier of tiers) {
        let used = 0;
        if (remaining > 0) {
          used = Math.min(remaining, tier.max - lastMax);
          remaining -= used;
        }
        costs.push({ used, cost: used * tier.rate });
        lastMax = tier.max;
      }
      return costs;
    }

    // HTMLテーブル作成
    let html = `<table><thead><tr><th></th><th colspan="2">内訳</th>`;

    for (const company of companies) {
      html += `<th colspan="2">${company.name}</th>`;
    }
    html += `</tr><tr><th>合計 (円)</th><th colspan="2"></th>`;
    for (const company of companies) {
      // 合計計算
      const tierCosts = calcTierCost(company.tiers, usage);
      const tierSum = tierCosts.reduce((sum, t) => sum + t.cost, 0);
      const fuelCharge = usage * company.fuelAdjustment;
      const reCharge = usage * company.reEnergyCharge;
      const total = company.basic + tierSum + fuelCharge + reCharge;
      html += `<th colspan="2">${total.toLocaleString(undefined, {minimumFractionDigits:1, maximumFractionDigits:1})}</th>`;
    }
    html += `</tr><tr><th>内訳</th><td rowspan="5" class="vertical-merge">基本料金から<br>第3段階料金まで</td><td rowspan="5" class="vertical-merge"></td>`;

    for (const company of companies) {
      // 空セル：基本料金・第一段階・第二段階・第三段階で2列ずつ必要なので基本料金と3段階はここで書く
      html += `<td>基本料金</td><td>${company.basic.toLocaleString()}円</td>`;
    }
    html += `</tr><tr>`;
    for (const company of companies) {
      const tierCosts = calcTierCost(company.tiers, usage);
      html += `<td>第1段階</td><td>${tierCosts[0].cost.toLocaleString(undefined, {minimumFractionDigits:1, maximumFractionDigits:1})}円</td>`;
    }
    html += `</tr><tr>`;
    for (const company of companies) {
      const tierCosts = calcTierCost(company.tiers, usage);
      html += `<td>第2段階</td><td>${tierCosts[1] ? tierCosts[1].cost.toLocaleString(undefined, {minimumFractionDigits:1, maximumFractionDigits:1}) : '0'}円</td>`;
    }
    html += `</tr><tr>`;
    for (const company of companies) {
      const tierCosts = calcTierCost(company.tiers, usage);
      html += `<td>第3段階</td><td>${tierCosts[2] ? tierCosts[2].cost.toLocaleString(undefined, {minimumFractionDigits:1, maximumFractionDigits:1}) : '0'}円</td>`;
    }
    html += `</tr><tr>`;
    for (const company of companies) {
      // 燃料調整費
      const fuel = usage * company.fuelAdjustment;
      html += `<td>燃料調整費</td><td>${fuel.toLocaleString(undefined, {minimumFractionDigits:1, maximumFractionDigits:1})}円</td>`;
    }
    html += `</tr><tr>`;
    html += `<th>再エネ賦課金 (円)</th><th colspan="2"></th>`;
    for (const company of companies) {
      const reCharge = usage * company.reEnergyCharge;
      html += `<td>再エネ賦課金</td><td>${reCharge.toLocaleString(undefined, {minimumFractionDigits:1, maximumFractionDigits:1})}円</td>`;
    }
    html += `</tr></thead></table>`;

    document.getElementById("result").innerHTML = html;
  }
  // 初期表示
  calculate();
</script>

</body>
</html>
